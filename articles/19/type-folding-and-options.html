

<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?" />

<title>
  
    Type Folding and Options
  
</title>
<meta name="description" content="A case for algebraic structures in TypeScript/JavaScript." />

<link
  rel="canonical"
  href="/articles/19/type-folding-and-options"
/>


<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
      processEscapes: true
    }
  });
</script>

<script
  type="text/javascript"
  src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML"
></script>



    <link
      rel="stylesheet"
      type="text/css"
      href="/css/post.css?1610213562212771500"
    />
  </head>

  <style></style>

  <body>
    <div class="container post">
      <div class="panel">
        <div class="column-right type folding and options-main">
          <section class="nav">
  <a class="nav-link" href="/about">about</a><a class="nav-link" href="/cc">cc</a><a class="nav-link" href="/vis">vis</a><a class="nav-link" href="https://forms.gle/RhcifB1j5aecMPFA8">feedback</a>
</section>
 <h1 class="title">Type Folding and Options</h1>
<p class="byline">October 3, 2019</p>

<article class="post">
  <p>Sometimes, I work with TypeScript compiler
APIs<span class="note"><label for="tsapi" class="margin-toggle">⊕</label></span><input type="checkbox" id="tsapi" class="margin-toggle"><span class="marginnote">They’re great APIs!</span>. Because the language
semantics are non-trivial, traversing a TypeScript AST almost always involves
extensive validation. Here’s a particularly specific traversal we use in the
<a href="https://angular.io/guide/language-service">Angular Language Service</a><span class="note"><label for="ng-ls" class="margin-toggle sidenote-number"></label></span><input type="checkbox" id="ng-ls" class="margin-toggle"><span class="sidenote">If the Language
Service is something that interests you and would like to contribute, please let me know! Or nike
swoosh it <img class="emoji" title=":slightly_smiling_face:" alt=":slightly_smiling_face:" src="https://gitlab.com/ayazhafiz/emoji-img/raw/master/public/emoji/unicode/1f642.png" height="20" width="20">.</span>:</p>

<noscript><pre>400: Invalid request</pre></noscript>
<script src="https://gist.github.com/e296d213923043d5b33381bc81a5fcd4.js"> </script>

<p>All validations branch on type checks, so in languages with design ideas like
<a href="http://adit.io/posts/2013-04-17-functors,_applicatives,_and_monads_in_pictures.html">functors and monads</a>
we could find great solutions to simplifying the type folding done here. I want
this to be a quick and (semi-)practical post, so I won’t explain what these words
mean; instead, here’s an approach that I find simplifies this code.</p>

<h3 id="rex">
<a class="header-anchor" href="#rex"></a>rex</h3>

<p>First, Rust. Rust has an
<a href="https://doc.rust-lang.org/stable/std/option/enum.Option.html"><code class="language-plaintext highlighter-rouge">Option</code></a> type
that can be <code class="language-plaintext highlighter-rouge">Some</code>thing or <code class="language-plaintext highlighter-rouge">None</code>thing.
<a href="https://doc.rust-lang.org/stable/std/option/enum.Option.html#method.map"><code class="language-plaintext highlighter-rouge">map</code></a>ping
an <code class="language-plaintext highlighter-rouge">Option</code> applies a predicate to a <code class="language-plaintext highlighter-rouge">Some</code> or propogates a <code class="language-plaintext highlighter-rouge">None</code>.</p>

<p>If the TypeScript API had Rust bindings, I would imagine the code above to look
something like</p>

<noscript><pre>400: Invalid request</pre></noscript>
<script src="https://gist.github.com/269f25526c492b193a73741a19c82eca.js"> </script>

<p>My hot take is that is way nicer - declaring the procedure functionally and
linearly makes it more readable to me.</p>

<h3 id="tess">
<a class="header-anchor" href="#tess"></a>tess</h3>

<p>Okay, so how do we get this in TypeScript? Well, for a variety of good
reasons<span class="note"><label for="ynot" class="margin-toggle sidenote-number"></label></span><input type="checkbox" id="ynot" class="margin-toggle"><span class="sidenote">Mainly because TypeScript is focused on supplementing JavaScript with types, not with more
language features that aren’t in the standard.</span>,
<code class="language-plaintext highlighter-rouge">Option</code>s<span class="note"><label for="noopt" class="margin-toggle sidenote-number"></label></span><input type="checkbox" id="noopt" class="margin-toggle"><span class="sidenote">TypeScript does
provide an <a href="https://developer.mozilla.org/en-US/docs/Web/API/HTMLOptionElement/Option">HTML Option</a>,
which is distinctly different.</span> will probably never be in the standard
library.
<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Optional_chaining">Optional chaining</a>
will help, but won’t solve type mapping.</p>

<p>For domains where it is still useful to have <code class="language-plaintext highlighter-rouge">Option</code> (and other monad-family)
types, there at least <a href="https://github.com/shogogg/ts-option">one library</a> that
can be used. If a library is too much, a lightweight <code class="language-plaintext highlighter-rouge">Option</code> can be written
very quickly:</p>

<noscript><pre>400: Invalid request</pre></noscript>
<script src="https://gist.github.com/2a42ded6979c988875188f6133639f78.js"> </script>

<p>Will the Angular Language Service use <code class="language-plaintext highlighter-rouge">Option</code>s? Probably not. But it’s a fun
idea!</p>

</article>

<section class="footer">
  
  <a href="/articles/19/equivalence-matters">« Equivalence Matters</a>
  
  <span><img class="emoji" title=":shoe:" alt=":shoe:" src="https://gitlab.com/ayazhafiz/emoji-img/raw/master/public/emoji/unicode/1f45e.png" height="20" width="20"> 
    <span>​
      <script type="math/tex">
        G = \left\{\Pi_n^0 g(x), \Pi_n^1 g(x), \dots, \Pi_n^{n-1} g(x) \right\}
      </script></span>
  </span>
  
  <a href="/articles/19/texas-carbon">Texas Carbon »</a>
  
</section>

<script type="text/javascript">
  function $(query) {
    return document.querySelector(query);
  }

  function $$(query) {
    return Array.from(document.querySelectorAll(query));
  }

  function isFullWidth() {
    return $(".post").classList.contains("full");
  }

  function toggleFullWidth() {
    const isFull = isFullWidth();
    isFull
      ? $(".post").classList.remove("full")
      : $(".post").classList.add("full");
    toggleShowHideNotes(!isFull);
    toggleShowHideNotesSwitch(!isFull);
    return !isFull;
  }

  function toggleShowHideNotes(isFullWidth) {
    const notes = $$(".marginnote").concat($$(".sidenote"));
    notes.forEach(note => {
      isFullWidth
        ? note.classList.add("maybe-hide")
        : note.classList.remove("maybe-hide");
    });
  }

  document.addEventListener("DOMContentLoaded", () => {
    $$(".note").forEach(toggle =>
      toggle.addEventListener("click", () => {
        if (isFullWidth()) {
          toggleFullWidth();
        }
      })
    );
  });
</script>

        </div>
      </div>
    </div>
  </body>
</html>
